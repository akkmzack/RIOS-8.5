<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Checking Domain Health</title>
    <link rel="StyleSheet" href="css/display-reports.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="display-reports.12.01.html#892817">Chapter 10	Viewing Reports and Logs</a> : Checking Domain Health</div>
    <hr align="left" />
    <blockquote>
      <div class="Heading1Topic"><a name="892817">Checking Domain Health</a></div>
      <div class="Body"><a name="892823">You run Windows domain diagnostic tests on a Steelhead appliance in the Reports &gt; Diagnostics &gt; Domain </a>Health Check page. </div>
      <div class="Body"><a name="892459">The RiOS Windows domain health check executes a variety of tests that provide diagnostics about the status </a>of domain membership, end-to-end Kerberos replication, both manual and automatic constrained delegation, and DNS resolution. This information enables you to resolve issues quickly.</div>
      <div class="Body"><a name="892463">Before running domain diagnostic delegation or replication tests, choose Configure &gt; Optimization &gt; </a>Domain Auth Auto Config or Configure &gt; Optimization &gt; Windows Domain Auth to configure a Windows user account that you can use for delegation or replication purposes. The Windows domain health check on the Steelhead appliance does not create the delegate or replication user; the Windows domain administrator must create the account in advance. For details, see <span class="xref"><a href="javascript:WWHClickedPopup('Management_Console_Online_Help_v8.5', 'setupDAAC.html#640663', '');" title="Configuring Domain Authentication Automatically">Easy Domain Authentication Configuration</a></span> or <span class="xref"><a href="javascript:WWHClickedPopup('Management_Console_Online_Help_v8.5', 'optimization.06.27.html#284558', '');" title="Windows Domain Authentication">Windows Domain Authentication</a></span>.</div>
      <div class="HeadingProcedure"><a name="892606">To run domain health tests</a></div>
      <div class="Step1_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Step1_inner" style="width: 16.128pt; white-space: nowrap;">
                <span class="Bold">1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="Step1_inner"><a name="892607">Choose Reports &gt; Diagnostics &gt; Domain Health Check to display the Domain Health Check page.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Body"><a name="892418">&nbsp;</a></div>
      <table class="RegularTable" style="text-align: left; width: 469.75176pt" cellspacing="0" summary="">
        <caption></caption>
        <tr>
          <td style="background-color: #ADBDF2; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 158.97528pt">
            <div class="CellHeading"><a name="892838">Control</a></div>
          </td>
          <td style="background-color: #ADBDF2; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 310.77648pt">
            <div class="CellHeading"><a name="892840">Description</a></div>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="892842">Test DNS</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="893460">Checks Steelhead appliance DNS settings, which must be correct for </a>Windows domain authentication, SMB signing, SMB2/3 signing, and encrypted MAPI optimization. A test status appears for the most recent test run: Passed, Failed, or Undetermined.</div>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893625">Domain/Realm</a></span> - Specify the fully qualified Active Directory domain in which the Steelhead appliance is a member. Typically, this is your company domain name.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893651">Test DNS </a></span>- Click to run the test. The Management Console dims this button until you specify the domain name.</li>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="892850">Test Join</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="954923">Confirms that the Steelhead appliance is correctly joined to the Windows </a>domain by verifying that the domain join configuration of the Steelhead appliance is valid on the backend domain controller in Active Directory. A test status appears for the most recent test run: Passed, Failed, or Undetermined.</div>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893749">Test Join </a></span>- Click to run the test. </li>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="892863">Test Delegation Setup</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="954938">Checks whether an account has the necessary Active Directory privileges </a>for delegation or automatic delegation. A test status appears for the most recent test run: Passed, Failed, or Undetermined.</div>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893772">Delegation Domain/Realm</a></span> - Select the fully qualified domain in which the Steelhead appliance is a member. Typically, this is your company domain name.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893815">Domain Controller</a></span> - Specify the host that provides user login service in the domain.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893773">Test Delegation Setup </a></span>- Click to run the test. The Management Console dims this button until you specify all required information.</li>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="892868">Test Delegation Privileges</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="954953">Confirms delegation privileges for a particular server by verifying that the </a>correct privileges are set to perform constrained delegation. Within SMB signing, SMB2/3 signing, and encrypted MAPI in delegation mode, the Steelhead appliance and the AD environment must have correct privileges to obtain Kerberos tickets for the CIFS or Exchange server and perform the subsequent authentication. A test status appears for the most recent test run: Passed, Failed, or Undetermined.</div>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893890">Delegation Domain/Realm</a></span> - Select the domain in which the Steelhead appliance is a member. Typically, this is your company domain name.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893886">Server</a></span> - Specify a delegate server hostname.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893920">Server IP</a></span> - Specify the delegate server IP address.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="893923">Service </a></span>- Select either CIFS or Exchange MDB.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894034">Account to Delegate</a></span> - Specify a domain user name.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="954283">Test Delegation Privileges </a></span>- Click to run the test.The Management Console dims this button until you specify all required information.</li>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="893170">Test NTLM Authentication</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="954968">Tests whether NTLM can successfully authenticate a user to the joined </a>domain. A test status appears for the most recent test run: Passed, Failed, or Undetermined.</div>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894122">Username</a></span> - Specify an Active Directory domain user name.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894123">Password</a></span> - Specify a password.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894349">Domain/Realm</a></span> - Specify the fully qualified domain of the Active Directory in which the Steelhead appliance is a member. Typically, this is your company domain name.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="954339">Short Domain Name </a></span>- Specify the short domain (NetBIOS) name if it does not match the first portion of the Active Directory domain name. Case matters; NBTTECH is not the same as nbttech.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894192">Test NTLM Authentication </a></span>- Click to run the test. The Management Console dims this button until you specify all required information.</li>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="892882">Test Replication Setup</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="954983">Tests the ability to replicate the server account by attempting to replicate a </a>server account using the replication user for the domain. A test status appears for the most recent test run: Passed, Failed, or Undetermined.</div>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894441">Delegation Domain/Realm</a></span> - Select the fully qualified domain of the Active Directory in which the replication user is a trusted member; for example: REPLICATION.TEST</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894422">Short Domain Name </a></span>- Specify the short domain (NetBIOS) name (or replication server) if it does not match the first portion of the Active Directory domain name. Case matters; NBTTECH is not the same as nbttech.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894469">Replication Server</a></span> - Specify a CIFS or Exchange replication server hostname.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894511">Test Replication Setup </a></span>- Click to run the test. The Management Console dims this button until you specify all required information.</li>
          </td>
        </tr>
        <tr>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="892887">Test Replication PRP</a></div>
          </td>
          <td style="border-bottom-color: #000000; border-bottom-style: solid; border-bottom-width: 1px; border-top-color: #000000; border-top-style: solid; border-top-width: 1px; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top">
            <div class="CellBody"><a name="954998">Ensures that the server account can be replicated as per the password </a>replication policy (PRP) on the domain controller. This test only works for Windows 2008 and later domains. A test status appears for the most recent test run: Passed, Failed, or Undetermined.</div>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894693">Replication Domain/Realm</a></span> - Select the fully qualified domain of the Active Directory in which the replication user is a trusted member: for example, REPLICATION.TEST</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894727">Domain Controller </a></span>- Specify the host that provides user login service in the domain.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894695">Replication Server</a></span> - Specify a CIFS or Exchange replication server hostname.</li>
            <li class="CellBullet"><span style="font-weight: bold"><a name="894696">Test Replication PRP </a></span>- Click to run the test. The Management Console dims this button until you specify all required information.</li>
          </td>
        </tr>
      </table>
      <div class="Heading4"><a name="953503">Viewing the Test Status </a></div>
      <div class="Body"><a name="953504">The time and date of the last test appears after Last Run.</a></div>
      <div class="Body"><a name="953505">When the test runs, the status </a><span style="font-weight: bold">In Progress </span>appears. After the test completes, the test logs and test result appear.</div>
      <div class="Heading3"><a name="953527">Viewing the Test Results</a></div>
      <div class="Body"><a name="953507">The test result can be one of the following:</a></div>
      <li class="Bullet"><span style="font-weight: bold"><a name="953508">Passed</a></span></li>
      <li class="Bullet"><span style="font-weight: bold"><a name="953509">Undetermined</a></span></li>
      <li class="Bullet"><span style="font-weight: bold"><a name="953510">Undetermined</a></span> - A test with an undetermined status indicates that the test could not accurately determine a pass or fail test status.</li>
      <div class="HeadingProcedure"><a name="953511">To view diagnostic test logs</a></div>
      <li class="Bullet"><a name="953513">Click </a><span style="font-weight: bold">Show logs</span>. The number of lines in the log appear after Show logs or Hide logs.</li>
      <div class="Body"><a name="957900">The test logs are usually interesting only after a test fails. </a></div>
      <div class="Body"><a name="953230">An abbreviated form of the timestamp appears in the left margin of each line. To see the original, full </a>timestamp in the form of a tooltip, hover the mouse over a timestamp. Not all log lines have timestamps, because third-party applications generate some of the logging data.</div>
      <div class="Body"><a name="952591">The log lines highlight errors in red and warnings in yellow. </a></div>
      <div class="Heading3"><a name="996822">Common Domain Health Errors</a></div>
      <div class="Body"><a name="996862">This section describes common problems that can occur when joining a Windows domain. </a></div>
      <div class="Heading4"><a name="996716">System Time Mismatch</a></div>
      <div class="Body"><a name="996717">The number one cause of failing to join a domain is a significant difference in the system time on the </a>Windows domain controller and the Steelhead appliance. When the time on the domain controller and the Steelhead appliance do not match, this error message appears:</div>
      <div class="Body"><a name="996724">&#8220;lt-kinit: krb5_get_init_creds: Clock skew too great&#8221; </a></div>
      <div class="Body"><a name="996727">Riverbed recommends using NTP time synchronization to synchronize the client and server clocks. It is </a>critical that the Steelhead appliance time is the same as on the Active Directory controller. Sometimes an NTP server is down or inaccessible, in which case there can be a time difference. You can also disable NTP if it is not being used and manually set the time. You must also verify that the time zone is correct. For details, see <span class="xref"><a href="javascript:WWHClickedPopup('Management_Console_Online_Help_v8.5', 'setupDateTime.html#1060003', '');" title="Configuring the Date and Time">Configuring the Date and Time</a></span>.</div>
      <div class="Tip">
        <span class="Bold">Tip: </span><a name="996737"> Select the primary DNS IP address to view the Configure &gt; Networking &gt; Host Settings page.</a></div>
      <div class="Heading4"><a name="996738">Invalid Domain Controller IP </a></div>
      <div class="Body"><a name="996739">A domain join can fail when the DNS server returns an invalid IP address for the Domain Controller. When </a>a DNS misconfiguration occurs during an attempt to join a domain, these error messages appear: </div>
      <div class="Body"><a name="996740">&#8220;Failed to join domain: failed to find DC for domain &lt;domain name&gt;&#8221; </a></div>
      <div class="Body"><a name="996741">&#8220;Failed to join domain: No Logon Servers&#8221;</a></div>
      <div class="Body"><a name="996742">Additionally, the Domain Join alarm triggers and messages similar to these appear in the logs:</a></div>
      <div class="CodeIndent1"><a name="996743">Oct 13 14:47:06 bravo-sh81 rcud[10014]: [rcud/main/.ERR] - {- -} Lookup for bravo-sh81.GEN-</a>VCS78DOM.COM Failed </div>
      <div class="CodeIndent1"><a name="996744">Oct 13 14:47:06 bravo-sh81 rcud[10014]: [rcud/main/.ERR] - {- -} Failed to join domain: failed </a>to find DC for domain GEN-VCS78DOM.COM </div>
      <div class="Body"><a name="996745">When you encounter this error, choose Configure &gt; Networking &gt; Host Settings and verify that the DNS </a>settings are correct. </div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <hr align="left" />
    <table align="right">
      <tr>
        <td class="WebWorks_Company_Logo_Bottom">
          <a href="http://riverbed.com" target="external_window"><img src="riverbed_logo_without_tagline.jpg" border="0" /></a>
        </td>
      </tr>
    </table>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>